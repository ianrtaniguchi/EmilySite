<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Minha Rotina</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icone.png">
  <style>
    body { font-family: sans-serif; padding: 10px; background: #f5f5f5; }
    h1 { text-align: center; }
    input, button { font-size: 1.2em; margin: 5px 0; padding: 5px; }
    .task { display: flex; justify-content: space-between; align-items: center; margin: 5px 0; background: #fff; padding: 10px; border-radius: 8px; }
    .done { text-decoration: line-through; color: gray; }
  </style>
</head>
<body>
  <h1>Minha Rotina</h1>
  <input type="text" id="taskInput" placeholder="Nova tarefa">
  <input type="time" id="taskTime">
  <button onclick="addTask()">Adicionar</button>
  <div id="tasks"></div>

  <script>
    // Permissão de notificações
    if (Notification.permission !== 'granted') {
      Notification.requestPermission();
    }

    // Carregar tarefas do localStorage
    let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
    tasks.forEach(t => displayTask(t));

    // Adicionar tarefa
    function addTask() {
      const taskText = document.getElementById('taskInput').value.trim();
      const taskTime = document.getElementById('taskTime').value;
      if(!taskText || !taskTime) return alert("Preencha todos os campos");

      const task = { text: taskText, time: taskTime, done: false };
      tasks.push(task);
      localStorage.setItem('tasks', JSON.stringify(tasks));
      displayTask(task);

      document.getElementById('taskInput').value = '';
      document.getElementById('taskTime').value = '';
    }

    // Mostrar tarefa na tela
    function displayTask(task) {
      const taskDiv = document.createElement('div');
      taskDiv.className = 'task';
      if(task.done) taskDiv.classList.add('done');
      taskDiv.innerHTML = `
        <span>${task.time} - ${task.text}</span>
        <div>
          <button onclick="toggleDone('${task.text}', '${task.time}', this)">✓</button>
          <button onclick="removeTask('${task.text}', '${task.time}', this)">X</button>
        </div>
      `;
      document.getElementById('tasks').appendChild(taskDiv);
    }

    // Marcar como concluída
    function toggleDone(text, time, btn) {
      tasks = tasks.map(t => {
        if(t.text === text && t.time === time) t.done = !t.done;
        return t;
      });
      localStorage.setItem('tasks', JSON.stringify(tasks));
      btn.parentElement.parentElement.classList.toggle('done');
    }

    // Remover tarefa
    function removeTask(text, time, btn) {
      tasks = tasks.filter(t => !(t.text === text && t.time === time));
      localStorage.setItem('tasks', JSON.stringify(tasks));
      btn.parentElement.parentElement.remove();
    }

    // Checar tarefas a cada minuto
    setInterval(() => {
      const now = new Date();
      const timeStr = now.toTimeString().slice(0,5);
      tasks.forEach(t => {
        if(t.time === timeStr && !t.notified) {
          new Notification('Hora da tarefa!', { body: t.text });
          t.notified = true;
        }
      });
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }, 60000);
  </script>
</body>
</html>
